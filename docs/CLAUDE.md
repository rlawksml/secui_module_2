# CLAUDE.md

이 파일은 Claude Code (claude.ai/code)가 이 저장소의 코드 작업 시 참고할 가이드를 제공합니다.

## 프로젝트 개요

JavaScript로 구축된 뱀파이어 서바이벌류 탑다운 슈팅 게임입니다. 자동 전투, 경험치/레벨링 시스템, 점진적으로 증가하는 난이도를 특징으로 합니다.

## 핵심 아키텍처

### 엔티티 시스템
- **Player**: 이동, 체력, 경험치 추적, 레벨 진행을 가진 메인 캐릭터
- **Enemy**: 단순한 경로 탐색으로 플레이어를 추적하는 AI 제어 엔티티
- **Projectile**: 플레이어로부터 발사되는 자동 타겟팅 발사체
- **ExperienceOrb**: 적이 드롭하는 자석 효과가 있는 수집 가능한 오브

### 시스템 아키텍처
- **SpawnSystem**: 난이도 스케일링(분당 20% 증가)을 적용한 적 스폰율 관리
- **CombatSystem**: 자동 타겟팅(가장 가까운 적), 발사체 발사(1회/초), 충돌 감지 처리
- **LevelSystem**: 경험치 누적 및 레벨업 계산 관리, 공식: `expToNextLevel = 10 * level^1.5`

### 게임 루프
- 목표: 60 FPS 렌더링
- 업데이트 사이클: 입력 → 이동 → 전투 → 충돌 → 스폰 → 렌더링
- 성능 요구사항: 100개 이상의 동시 적과 50개 이상의 발사체 처리

## 주요 기술 세부사항

### 전투 메커니즘
- 자동 타겟팅은 화면 범위 내 가장 가까운 적 선택
- 발사체: 400px/s 속도, 20 기본 데미지, 1회 관통
- 공격 속도: 초당 1 발사체 (기본)
- 적 접촉 데미지: 충돌 시 10 HP/s

### 레벨링 시스템
- 적 처치당 경험치: 5 EXP
- 레벨업 보너스:
  - 체력 완전 회복
  - 이동 속도 +5%
  - 공격 데미지 +10%
- 레벨 제한 없음

### 스폰 시스템
- 기본 속도: 초당 2마리
- 스케일링 공식: `spawnRate = baseSpawnRate * (1 + 0.2 * floor(gameTime / 60))`
- 최대 동시 적 수: 200마리
- 스폰 위치: 화면 밖 랜덤 위치

### 충돌 및 물리
- 플레이어 이동: 200px/s 기본 속도, WASD/방향키
- 화면 경계에서 이동 제한
- 대각선 이동 시 속도 정규화 필요
- 경험치 오브 수집: 50px 반경, 자석 효과 (300px/s 끌어당김)

## 개발 명령어

### 빌드 & 실행
```bash
npm install          # 의존성 설치
npm run dev          # 개발 서버 시작 (Vite/Webpack)
npm run build        # 프로덕션 빌드
npm run preview      # 프로덕션 빌드 미리보기
```

### 성능 테스트
테스트 조건에 포함되어야 할 사항:
- 적 100마리 + 발사체 50개 동시 존재
- 10분 이상 지속 플레이 세션
- 메모리 누수 및 30 FPS 이하 드롭 모니터링

## 파일 구조
```
src/
├── index.js              # 진입점, 게임 초기화
├── game.js               # 메인 게임 루프, 상태 관리
├── entities/
│   ├── Player.js         # 플레이어 클래스 (위치, 속도, 스탯)
│   ├── Enemy.js          # 적 클래스 (AI, 경로 탐색)
│   ├── Projectile.js     # 발사체 클래스 (이동, 타겟팅)
│   └── ExperienceOrb.js  # 경험치 오브 클래스 (자석 수집)
├── systems/
│   ├── SpawnSystem.js    # 적 스폰 로직
│   ├── CombatSystem.js   # 자동 공격, 데미지 계산
│   └── LevelSystem.js    # 경험치/레벨 진행
└── utils/
    ├── math.js           # 거리, 정규화 유틸리티
    └── collision.js      # 충돌 감지 알고리즘
```

## 최적화 전략

### 필수 최적화
- **오브젝트 풀링**: GC 압력을 줄이기 위해 발사체 및 적 인스턴스 재사용
- **공간 분할**: 쿼드트리 또는 그리드 기반 충돌 감지 사용 (전수 조사 방식 사용 금지)
- **컬링**: 화면 밖 엔티티 렌더링 스킵
- **할당 최소화**: 핫패스에서 벡터/객체 재사용

### 성능 목표
- 적 100마리 동시 존재 시 안정적인 60 FPS
- 메모리 사용량 < 100MB
- 초기 로딩 시간 < 2초

## UI 컴포넌트

### HUD 요소 (화면 상단)
- 체력바: 빨간색, 현재/최대 HP 표시
- 경험치바: 파란색, 다음 레벨까지 진행도 (%) 표시
- 현재 레벨 표시기
- 생존 타이머 (MM:SS 형식)

### 게임 상태
- **Playing**: 활성 게임플레이
- **LevelUp**: 화면 중앙에 "LEVEL UP!" 텍스트 표시 (1초)
- **GameOver**: 통계 표시 (생존 시간, 도달 레벨, 처치 수), 재시작 버튼

## 테스트 중점 영역

1. **이동**: WASD 제어, 화면 경계 충돌, 대각선 정규화
2. **전투**: 자동 타겟팅 로직, 발사체 충돌 정확도, 데미지 적용
3. **진행**: 경험치 누적, 레벨업 스탯 증가, 공식 정확성
4. **성능**: 부하 상황 FPS 안정성, 메모리 누수 감지
5. **스폰 스케일링**: 난이도 곡선, 최대 적 수 제한 적용

## 주의사항

- 대각선 이동 속도는 반드시 정규화 (velocity.length는 기본 속도와 같아야 함)
- 적 스폰 위치는 화면 밖에 완전히 위치해야 팝인 방지 가능
- 레벨업 공식은 지수 1.5 사용, 선형 스케일링 아님
- 발사체는 충돌 또는 화면 밖 이동 시 제거해야 메모리 문제 방지
- 수집 범위(50px)는 자석 활성화 범위와 별개 (같거나 다를 수 있음)
